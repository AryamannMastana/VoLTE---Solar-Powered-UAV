% First loop (without spar)
x1 = [0.185199, 0.0608225, -0.0634537, -0.187901, -0.183813, -0.0599916, 0.0639373, 0.185199];
y1 = [-0.00909689, -0.0100312, -0.0181644, -0.021772, 0.0193755, 0.0299983, 0.0187877, -0.00909689];

% second loop (with spar)
x2 = [0.185199, 0.0608225, -0.0634537, -0.0599916, 0.0639373, 0.185199];
y2 = [-0.00909689, -0.0100312, -0.0181644, 0.0299983, 0.0187877, -0.00909689];

% figure(1);
% plot(x,y);
% xlim([-0.2, 0.2]);
% ylim([-0.15, 0.15]);

% MOI values
I_xx = 1.44 * 10e7;
I_yy = 6.35 * 10e6;
I_xy = 1.56 * 10e8;
D = I_xx*I_yy - I_xy^2;
V_x = 0;
V_y = 37.5; % 37.5 N

a = (V_x*I_xx - V_y*I_xy)/D;
b = (V_y*I_yy - V_x*I_xy)/D;

t = 0.5 * 10e-3;
l = [];
A = [];

% Shear flows for 2 loops, will be added later
q1 = [];
q2 = [];

% initial shear flow conditions (found through iters)
% q1_i = -1.5361e-11; q2_i = -2.7958e-11; 
q1_i = 0; q2_i = 0;

% First loop
for i = 1:7

    l(i) = norm([x1(i) y1(i)] - [x1(i+1) y1(i+1)]);
    
    A(2*i-1) = 1/3 * l(i) * t;
    if i == 1
        q1(2*i-1) = A(2*i-1) * (a*x1(i) + b*y1(i)) + q1_i;
    else
        q1(2*i-1) = A(2*i-1) * (a*x1(i) + b*y1(i)) + q1(2*i-2);
    end
    
    A(2*i) = 2/3 * l(i) * t;
    q1(2*i) = A(2*i) * (a*x1(i) + b*y1(i)) + q1(2*i - 1);

end

% Second loop
for i = 1:5

    l(i) = norm([x1(i) y1(i)] - [x1(i+1) y1(i+1)]);
    
    A(2*i-1) = 1/3 * l(i) * t;
    if i == 1
        q2(2*i-1) = A(2*i-1) * (a*x2(i) + b*y2(i)) + q2_i;
    else
        q2(2*i-1) = A(2*i-1) * (a*x2(i) + b*y2(i)) + q2(2*i-2);
    end
    
    A(2*i) = 2/3 * l(i) * t;
    q2(2*i) = A(2*i) * (a*x2(i) + b*y2(i)) + q2(2*i - 1);

end

q2_fixed = [];

for i = 1:7
    for i = 1:2
        q2_fixed(2*i-1) = q2(2*i-1);
        q2_fixed(2*i) = q2(2*i);
    end
    for i = 3:5
        q2_fixed(2*i-1) = 0;
        q2_fixed(2*i) = 0;
    end
    for i = 6:7
        q2_fixed(2*i-1) = q2(2*i-1-4);
        q2_fixed(2*i) = q2(2*i-4);
    end
end    

% x = linspace(-0.2,0.2,100);
q_total = q1 + q2_fixed;

% x = [100,99.65799,98.694,97.214,95.264,92.842,89.97,86.697,83.074,79.148,74.959,70.552,65.968,61.252,56.447,51.597,46.746,41.937,37.212,32.614,28.182,23.957,19.977,16.279,12.898,9.862,7.199,4.93,3.072,1.639,0.638,0.084,0,0.062,0.622,1.718,3.313,5.396,7.955,10.974,14.428,18.29,22.523,27.086,31.931,37.009,42.267,47.649,53.096,58.546,63.935,69.196,74.262,79.065,83.53601,87.609,91.21701,94.292,96.76,98.555,99.638,100];
% y = [0,0.098,0.401,0.881,1.462,2.107,2.818,3.584,4.382,5.184,5.962,6.695,7.36,7.942,8.423,8.792,9.039,9.157,9.144,8.998,8.724,8.327,7.815,7.199,6.49,5.701,4.847,3.945,3.016,2.086,1.188,0.369,0,-0.297,-0.873,-1.432,-1.929,-2.344,-2.665,-2.889,-3.015,-3.048,-2.995,-2.864,-2.664,-2.404,-2.094,-1.75,-1.385,-1.015,-0.655,-0.321,-0.027,0.213,0.388,0.491,0.516,0.462,0.339,0.183,0.052,0];

x_plot = [];

for i = 1:7
    x_plot(2*i-1) = x1(i);
    x_plot(2*i) = 0.5*(x(i) + x(i+1));
end

figure(1);
x_plot = linspace(0,0.3,7);
hold on
plot(x_plot,q_total(1:7), 'bo--');
% plot(x/100,y,'k--')
plot(x_plot,q_total(8:14), 'ro--');
hold off
xlim([0, 0.3]);
legend(['Top'],['Bottom']);
grid();

% hold on
% plot(x_plot(1:7), q_total(1:7), 'bo');
% % plot(x/100,y,'k--')
% plot(x_plot(8:14), q_total(8:14), 'ro');
% hold off
% xlim([-0.2, 0.2]);
% ylim([-0.15, 0.15]);

q1
q2 
q2_fixed
q_total

sum(q1)









