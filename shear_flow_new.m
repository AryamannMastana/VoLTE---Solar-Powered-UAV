clc; clear all; close all;
V =[37.65278,37.28397043,36.91426567,36.54367484,36.17220723,35.79987228,35.42667961,35.05263897,34.67776035,34.30205388,33.92552994,33.54819908,33.1700721  32.79116002 32.41147413 32.03102595 31.64982727 31.26789019,30.88522707 30.5018506  30.1177738  29.73301    29.34757291 28.9614766,28.57473551,28.18736452,27.7993789,27.41079438,27.02162712,26.63189382,26.24161161,25.85079822,25.45947187,25.0676514,24.67535622,24.28260639,23.88942263,23.49582635,23.10183966,22.70748546,22.31278744,21.91777009,21.52245882,21.12687991,20.73106063,20.33502925,19.9388151,19.54244862,19.14596142,18.74938635,18.35275755,17.95611052,17.55948221,17.16291108,16.7664372,16.37010233,15.97395002,15.57802571,15.18237685,14.78705302,14.39210606,13.99759018,13.60356217,13.21008152,12.81721062,12.42501495,12.03356328,11.64292794,11.25318502,10.8644147,10.47670155,10.09013486,9.70480902,9.32082395,8.93828559,8.55730641,8.178006,7.80051179,7.42495976,7.05149539,6.68027461,6.31146505,5.94524732,5.5818167,5.22138503,4.86418298,4.51046285,4.16050195,3.81460686,3.4731187,3.13642009,2.80494406,2.47918631,2.15972199,1.84723007,1.54253005,1.24664076,0.96088235,0.68707461,0.4279966,0.18886538];
Isp = [1.31210719e-08,1.27888589e-08,1.24619556e-08 ,1.21403286e-08,1.18239442e-08,1.15127682e-08,1.12067666e-08,1.09059051e-08,1.06101490e-08,1.03194637e-08,1.00338141e-08,9.75316536e-09,9.47748199e-09,9.20672856e-09,8.94086939e-09,8.67986862e-09,8.42369019e-09,8.17229787e-09,7.92565524e-09,7.68372568e-09,7.44647240e-09,7.21385840e-09,6.98584653e-09,6.7239942e-09,6.54347952e-09,6.32904912e-09,6.11907029e-09,5.91350493e-09,5.71231475e-09,5.51546128e-09  5.32290586e-09  5.13460965e-09,4.95053360e-09,4.77063851e-09,4.59488496e-09,4.42323335e-09,4.25564392e-09,4.09207668e-09,3.93249149e-09,3.77684799e-09,3.62510565e-09,3.47722376e-09,3.33316138e-09,3.19287743e-09,3.05633059e-09,2.92347940e-09,2.79428215e-09,2.66869699e-09,2.54668184e-09,2.42819443e-09,2.31319231e-09,2.20163282e-09,2.09347309e-09,1.98867007e-09,1.88718050e-09,1.78896092e-09,1.69396765e-09,1.60215682e-09,1.51348434e-09,1.42790592e-09,1.34537704e-09,1.26585297e-09,1.18928877e-09,1.11563927e-09,1.04485906e-09,9.76902528e-10,9.11723803e-10,8.49276789e-10,7.89515142e-10,7.32392270e-10,6.77861324e-10,6.25875195e-10,5.76386504e-10,5.29347593e-10,4.84710520e-10,4.42427043e-10,4.02448613e-10,3.64726358e-10,3.29211069e-10,2.95853186e-10,2.64602774e-10,2.35409506e-10,2.08222633e-10,1.82990961e-10,1.59662810e-10,1.38185981e-10,1.18507704e-10,1.00574583e-10,8.43325303e-11,6.97266800e-11,5.67012886e-11,4.51996045e-11,3.51637030e-11,2.65342700e-11,1.92503100e-11,1.32487375e-11,8.46377939e-12,4.82604319e-12,2.26092254e-12,6.85442825e-13,6.85442825e-14];
x = [100,99.65799,98.694,97.214,95.264,92.842,89.97,86.697,83.074,79.148,74.959,70.552,65.968,61.252,56.447,51.597,46.746,41.937,37.212,32.614,28.182,23.957,19.977,16.279,12.898,9.862,7.199,4.93,3.072,1.639,0.638,0.084,0,0.062,0.622,1.718,3.313,5.396,7.955,10.974,14.428,18.29,22.523,27.086,31.931,37.009,42.267,47.649,53.096,58.546,63.935,69.196,74.262,79.065,83.53601,87.609,91.21701,94.292,96.76,98.555,99.638,100];
y = [0,0.098,0.401,0.881,1.462,2.107,2.818,3.584,4.382,5.184,5.962,6.695,7.36,7.942,8.423,8.792,9.039,9.157,9.144,8.998,8.724,8.327,7.815,7.199,6.49,5.701,4.847,3.945,3.016,2.086,1.188,0.369,0,-0.297,-0.873,-1.432,-1.929,-2.344,-2.665,-2.889,-3.015,-3.048,-2.995,-2.864,-2.664,-2.404,-2.094,-1.75,-1.385,-1.015,-0.655,-0.321,-0.027,0.213,0.388,0.491,0.516,0.462,0.339,0.183,0.052,0];
z = linspace(0,1.1,100);
Bt=[];
B=[];
dl=[];
xZ = [];
yZ = [];
b = 2.2;
t = 0.5;
z = linspace(0,1.1,100);
Isk = zeros(100);
It = zeros(100);

%Hand calculation

for i = 1:100
    IZ = 0;
    for j = 1:62
        xZ(j) = x(j)*2.94*(1-(z(i)/b))*0.001;
        yZ(j) = y(j)*2.94*(1-(z(i)/b))*0.001;
    end
    for k = 1:61
        dZ = sqrt((xZ(k)-xZ(k+1))^2 + (yZ(k)-yZ(k+1))^2);
        ymZ = (yZ(k)+yZ(k+1))/2;
        diZ = ymZ*ymZ*dZ*t;
        IZ = IZ + diZ;
    end
    Isk(i) = IZ;
    It(i) = Isk(i) + Isp(i);
end

xh = [4.930,19.977,32.614,51.597,74.959,92.842,94.292,69.196,53.096,31.931,22.523,5.396];
yh = [3.945,7.815,8.998,8.792,5.962,2.107,0.462,-0.321,-1.385,-2.664,-2.995,-2.344];

l=0; sa = 0;
ar1=0;ar2=0; Q1=zeros(38);Q2=zeros(26); qs1 = zeros(1);qs2 = zeros(1); sa1=0;sa2=0; q01=zeros(1);q02=zeros(1); q1=zeros(1);q2=zeros(1); q21=zeros(38);q22=zeros(26); q11=zeros(1);q12=zeros(1); A1=0;A2=0;
Q = zeros(62); x1 =[]; y1 =[]; ys = []; q1 = []; q2 = []; xa = []; ya = []; xa1 = []; ya1 = []; ar = []; q = zeros(1); qs = zeros(1); q0 = zeros(1);
lp = length(x);
for i = 1:1
    for j = 1:lp
        x1(j) = x(j)*2.94*(1-(z(i)/b))*0.001;
        y1(j) = y(j)*2.94*(1-(z(i)/b))*0.001;
    end
    l=length(x1);
    [xc,yc] = Centroid(x1,y1);
    t = 0.0005;
    for j = 1:l
            ys(j) = y1(j) - yc;
    end
    x2 = [x1(1:20),x1(45:62)];
    y2 = [y1(1:20),y1(45:62)];
    x3 = [x1(20:45)];
    y3 = [y1(20:45)];
    ys1 = [ys(1:20),ys(45:62)];
    ys2 = [ys(20:45)];
    
    
    %B
    %ys
    
    for j = 1:l
        Q(j) = Q(j) + B(j)*ys(j);
    end
    for j = 1:l
        q1(j) = V(i)*Q(j)/It(i);
        qs(i) = qs(i) + q1(j);
    end
    qs(i)
    for j = 1:l-3
        xa = [x1(1),x1(j+2),x1(j+3)];
        ya = [y1(1),y1(j+2),y1(j+3)];
        ar(i) = polyarea(xa,ya);
        sa = sa + polyarea(xa,ya)*V(i)*(Q(j+2)+Q(j+3))/It(i);
    end
    A = polyarea(x1,y1);
    q0(i) = sa/A;
    q(i) = qs(i) + l*q0(i);
    for j =1:l
        q2(j)=q1(j)+q0(i);
    end
    q(i)
    plot(x1,q2*1000)
    xlabel("x (m)");
    ylabel("Shear flow (N/m)");
    title("Variation of shear flow with x at root without spar")
    grid on
    %hold on
    %plot(x1,y1)


    %Spar part here
    
    B(20) = B(20) + (y1(20)-y1(45))*t*(2+(y1(45)/y1(20)))/6;
    B(45) = B(45) + (y1(20)-y1(45))*t*(2+(y1(20)/y1(45)))/6;
    B1 = [B(1:20),B(45:62)];
    B2 = [B(20:45)];
    for j = 1:38
        Q1(j) = Q1(j) + B1(j)*ys1(j);
    end
    for j = 1:38
        q11(j) = V(i)*Q1(j)/It(i);
        qs1(i) = qs1(i) + q11(j);
    end
    %qs1(i) 
    for j = 1:35
        xa1 = [x2(1),x2(j+2),x2(j+3)];
        ya1 = [y2(1),y2(j+2),y2(j+3)];
        ar1(i) = polyarea(xa1,ya1);
        sa1 = sa1 + polyarea(xa1,ya1)*V(i)*(Q1(j+2)+Q1(j+3))/It(i);
    end
    A1 = polyarea(x2,y2);
    q01(i) = sa1/A1;
    q00(i) = qs1(i) + 38*q01(i);
    for j =1:38
        q21(j)=q11(j)+q01(i);
    end


    for j = 1:26
        Q2(j) = Q2(j) + B2(j)*ys2(j);
    end
    for j = 1:26
        q12(j) = V(i)*Q2(j)/It(i);
        qs2(i) = qs2(i) + q12(j);
    end
    %qs1(i) ar1,2 Q1,2 qs1,2 sa1,2 q01,2 q1,2 q21,2 q11,2 A1,2
    for j = 1:23
        xa = [x3(1),x3(j+2),x3(j+3)];
        ya = [y3(1),y3(j+2),y3(j+3)];
        ar2(i) = polyarea(xa,ya);
        sa2 = sa2 + polyarea(xa,ya)*V(i)*(Q2(j+2)+Q2(j+3))/It(i);
    end
    A2 = polyarea(x3,y3);
    q02(i) = sa2/A2;
    q000(i) = qs1(i) + 38*q02(i);
    for j =1:26
        q22(j)=q12(j)+q02(i);
    end
    qplot=[q21(1:20),q22(2:25),q21(21:38)];

    figure(2)
    plot(x1,qplot*1000)
    xlabel("x (m)");
    ylabel("Shear flow (N/m)");
    title("Variation of shear flow with x (with spar)")
    grid on
    hold on
    %plot(x2,q21)
    %plot(x3,q22)
    %xlabel("x");
    %ylabel("Shear flow");
    %title("Variation of shear flow with x3")
    %grid on
[x,y]=ShearCentre(x1,y1,qplot,V(i))

end
function [xc,yc] = Centroid(x,y)
    l=length(x);
    xs = 0;
    ys = 0;
    dls = 0;
    xc = 0;
    yc = 0;
    dl = zeros(l);
    for i=1:l-1
        dl(i) = sqrt((x(i)-x(i+1)^2 + (y(i)-y(i+1))^2));
        xs = xs + dl(i)*x(i);
        ys = ys + dl(i)*y(i);
        dls = dls + dl(i);
    end
    xc=xs/dls;
    yc=ys/dls;
end
function B = boom_area(x1,y1)
for j = 1:l 
        if j==1
            dl1(j) = sqrt((x1(j+1)-x1(j))^2 + (y1(j+1)-y1(j))^2);
            dl2(j) = sqrt((x1(l)-x1(j))^2 + (y1(l)-y1(j))^2);
            B(j) = t*(dl1(j)*(2 + (ys(j+1)/ys(j))) + dl2(j)*(2 + ys(12)/ys(j)))/6;
        elseif j==l
            dl1(j) = sqrt((x1(1)-x1(j))^2 + (y1(1)-y1(j))^2);
            dl2(j) = sqrt((x1(j-1)-x1(j))^2 + (y1(j-1)-y1(j))^2);
            B(j) = t*(dl1(j)*(2 + (ys(1)/ys(j))) + dl2(j)*(2 + ys(j-1)/ys(j)))/6;
        else
            dl1(j) = sqrt((x1(j+1)-x1(j))^2 + (y1(j+1)-y1(j))^2);
            dl2(j) = sqrt((x1(j-1)-x1(j))^2 + (y1(j-1)-y1(j))^2);
            B(j) = t*(dl1(j)*(2 + (ys(j+1)/ys(j))) + dl2(j)*(2 + ys(j-1)/ys(j)))/6;
        end
end
end
function [xsc,ysc] = ShearCentre(x,y,q,V)
l = length(q);
[xc,yc] = Centroid(x,y);
sum = 0;
pt = [xc,yc,0];
for j=1:l-1
        dl(j)=sqrt((x(j)-x(j+1))^2+(y(j)-y(j+1))^2);
        v1 = [x(j),y(j),0];
        v2 = [x(j+1),y(j+1),0];
        rp(j) = rperp(pt,v1,v2);
        sum = sum + q(j)*dl(j)*rp(j);
end
ysc = 0;
sum
xsc = sum/V;
end
function d = rperp(pt, v1, v2)
      a = v1 - v2;
      b = pt - v2;
      d = norm(cross(a,b)) / norm(a);
end